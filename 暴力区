if _G.XION_Script_Loaded then
    _G.XION_Execution_Count = (_G.XION_Execution_Count or 0) + 1
    return
end

_G.XION_Script_Loaded = true
_G.XION_Execution_Count = 1

local WindUI = loadstring(game:HttpGet("https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"))()
local Window = WindUI:CreateWindow({
    Title = "XIONè‡ªåŠ¨é˜²æŠ¤",
    Icon = "shield",
    Author = "å¸ç©ºåˆ¶ä½œ",
    Folder = "CloudHub",
    Size = UDim2.fromOffset(560, 400),
    Transparent = true,
    User = {
        Enabled = true,
        Callback = function() 
            print("clicked") 
        end,
        Anonymous = true
    },
})

Window:EditOpenButton(
    {
        Title = "é˜²æŠ¤ç³»ç»Ÿ",
        Icon = "shield",
        CornerRadius = UDim.new(0, 13),
        StrokeThickness = 4,
        Color = ColorSequence.new({ColorSequenceKeypoint.new(0, Color3.fromRGB(186, 19, 19)),ColorSequenceKeypoint.new(1, Color3.fromRGB(8, 60, 129))}),
        Draggable = true
    }
)

function Tab(a)
    return Window:Tab({Title = a, Icon = "shield"})
end

function Button(a, b, c)
    return a:Button({Title = b, Callback = c})
end

function Toggle(a, b, c, d)
    return a:Toggle({Title = b, Value = c, Callback = d})
end

function Input(a, b, c, d, e, f)
    return a:Input({
        Title = b,
        Desc = c or "",
        Value = d or "",
        Placeholder = e or "",
        Callback = f
    })
end

-- åˆ›å»ºè‡ªåŠ¨é˜²æŠ¤æ ‡ç­¾é¡µ
local AutoProtectTab = Tab("è‡ªåŠ¨é˜²æŠ¤")

-- è‡ªåŠ¨é˜²æŠ¤åŠŸèƒ½å˜é‡
local autoProtectEnabled = false
local protectConnection = nil
local lastClickTime = 0

-- éœ€è¦æ£€æµ‹çš„åŠ¨ä½œIDåˆ—è¡¨
local protectedAnimations = {
    "92362656727126",
    "108276889954601", 
    "126497551689502",
    "126626340093785",
    "121571390309073",
    "119752564209631"
}

-- é˜²æŠ¤è®¾ç½®
local protectionSettings = {
    detectionRange = 50,
    clickDelay = 0.1,
    cooldown = 50,  -- ç‚¹å‡»å†·å´æ—¶é—´æ”¹ä¸º50ç§’
    debugMode = false
}

-- è™šæ‹Ÿé¼ æ ‡å³é”®ç‚¹å‡»å‡½æ•°
function virtualRightClick()
    local currentTime = tick()
    
    -- æ£€æŸ¥å†·å´æ—¶é—´
    if currentTime - lastClickTime < protectionSettings.cooldown then
        if protectionSettings.debugMode then
            print("[" .. os.date("%X") .. "] å†·å´ä¸­ï¼Œå‰©ä½™æ—¶é—´: " .. string.format("%.1f", protectionSettings.cooldown - (currentTime - lastClickTime)) .. "ç§’")
        end
        return
    end
    
    lastClickTime = currentTime
    
    -- ä½¿ç”¨VirtualInputManageræ¨¡æ‹Ÿé¼ æ ‡å³é”®ç‚¹å‡»
    local virtualInputManager = game:GetService("VirtualInputManager")
    
    -- é¼ æ ‡å³é”®æŒ‰ä¸‹ (æŒ‰é’®ä»£ç 2ä»£è¡¨å³é”®)
    virtualInputManager:SendMouseButtonEvent(0, 0, 2, true, game, 1)
    
    -- çŸ­æš‚å»¶è¿Ÿ
    wait(protectionSettings.clickDelay)
    
    -- é¼ æ ‡å³é”®é‡Šæ”¾
    virtualInputManager:SendMouseButtonEvent(0, 0, 2, false, game, 1)
    
    if protectionSettings.debugMode then
        print("[" .. os.date("%X") .. "] æ£€æµ‹åˆ°å—ä¿æŠ¤åŠ¨ä½œï¼Œå·²è‡ªåŠ¨ç‚¹å‡»é¼ æ ‡å³é”®")
        print("[" .. os.date("%X") .. "] ä¸‹æ¬¡å¯ç‚¹å‡»æ—¶é—´: " .. os.date("%X", currentTime + protectionSettings.cooldown))
    end
end

-- æ”¹è¿›çš„åŠ¨ç”»æ£€æµ‹å‡½æ•°
function checkForProtectedAnimations()
    local localPlayer = game.Players.LocalPlayer
    if not localPlayer or not localPlayer.Character then
        return false
    end
    
    local localRoot = localPlayer.Character:FindFirstChild("HumanoidRootPart")
    if not localRoot then
        return false
    end
    
    for _, player in ipairs(game.Players:GetPlayers()) do
        if player ~= localPlayer and player.Character then
            -- æ£€æŸ¥è·ç¦»
            local targetRoot = player.Character:FindFirstChild("HumanoidRootPart")
            if targetRoot then
                local distance = (localRoot.Position - targetRoot.Position).Magnitude
                if distance <= protectionSettings.detectionRange then
                    -- æ£€æŸ¥åŠ¨ç”»
                    local humanoid = player.Character:FindFirstChildOfClass("Humanoid")
                    if humanoid then
                        local animator = humanoid:FindFirstChildOfClass("Animator")
                        if animator then
                            for _, track in pairs(animator:GetPlayingAnimationTracks()) do
                                if track.IsPlaying then
                                    local animation = track.Animation
                                    if animation then
                                        -- æå–åŠ¨ç”»ID
                                        local animationIdStr = tostring(animation.AnimationId)
                                        local animationId = animationIdStr:match("%d+")
                                        
                                        if animationId then
                                            -- æ£€æŸ¥æ˜¯å¦æ˜¯å—ä¿æŠ¤çš„åŠ¨ä½œ
                                            for _, protectedId in ipairs(protectedAnimations) do
                                                if animationId == protectedId then
                                                    if protectionSettings.debugMode then
                                                        print("[" .. os.date("%X") .. "] æ£€æµ‹åˆ°ç©å®¶ " .. player.Name .. " æ’­æ”¾å—ä¿æŠ¤åŠ¨ä½œ: " .. protectedId)
                                                    end
                                                    return true
                                                end
                                            end
                                        end
                                    end
                                end
                            end
                        end
                    end
                end
            end
        end
    end
    
    return false
end

-- åˆ›å»ºè‡ªåŠ¨é˜²æŠ¤å¼€å…³
Toggle(AutoProtectTab, "å¯ç”¨è‡ªåŠ¨é˜²æŠ¤", false, function(value)
    autoProtectEnabled = value
    
    if value then
        -- å¯ç”¨è‡ªåŠ¨é˜²æŠ¤
        if protectConnection then
            protectConnection:Disconnect()
        end
        
        protectConnection = game:GetService("RunService").Heartbeat:Connect(function()
            if autoProtectEnabled and checkForProtectedAnimations() then
                virtualRightClick()
            end
        end)
        
        print("ğŸ›¡ï¸ è‡ªåŠ¨é˜²æŠ¤å·²å¯ç”¨ (å³é”®æ¨¡å¼)")
        print("â° å†·å´æ—¶é—´: " .. protectionSettings.cooldown .. "ç§’")
    else
        -- ç¦ç”¨è‡ªåŠ¨é˜²æŠ¤
        if protectConnection then
            protectConnection:Disconnect()
            protectConnection = nil
        end
        print("âŒ è‡ªåŠ¨é˜²æŠ¤å·²ç¦ç”¨")
    end
end)

-- æ·»åŠ è¯´æ˜
AutoProtectTab:Paragraph({
    Title = "è‡ªåŠ¨é˜²æŠ¤ç³»ç»Ÿ - å³é”®æ¨¡å¼",
    Desc = "å½“æ£€æµ‹åˆ°é™„è¿‘ç©å®¶æ’­æ”¾ç‰¹å®šæ”»å‡»åŠ¨ä½œæ—¶ï¼Œè‡ªåŠ¨ç‚¹å‡»é¼ æ ‡å³é”®è¿›è¡Œé˜²å¾¡\nå†·å´æ—¶é—´: 50ç§’",
    Image = "shield",
    ImageSize = 20,
    Color = Color3.fromHex("#FF6B6B")
})

-- æ˜¾ç¤ºå—ä¿æŠ¤åŠ¨ä½œåˆ—è¡¨
local animListText = "å—ä¿æŠ¤åŠ¨ä½œIDåˆ—è¡¨ï¼š\n"
for i, animId in ipairs(protectedAnimations) do
    animListText = animListText .. "â€¢ " .. animId .. "\n"
end

AutoProtectTab:Paragraph({
    Title = "é˜²æŠ¤åŠ¨ä½œæ¸…å•",
    Desc = animListText,
    Image = "list",
    ImageSize = 20,
    Color = Color3.fromHex("#4ECDC4")
})

-- è®¾ç½®åŒºåŸŸ
AutoProtectTab:Paragraph({
    Title = "é˜²æŠ¤è®¾ç½®",
    Desc = "è°ƒæ•´è‡ªåŠ¨é˜²æŠ¤çš„å‚æ•°",
    Image = "settings",
    ImageSize = 20,
    Color = Color3.fromHex("#45B7D1")
})

-- æ£€æµ‹èŒƒå›´è®¾ç½®
Input(AutoProtectTab, "æ£€æµ‹èŒƒå›´(ç±³)", "è®¾ç½®è‡ªåŠ¨é˜²æŠ¤çš„æ£€æµ‹èŒƒå›´", tostring(protectionSettings.detectionRange), "ä¾‹å¦‚ï¼š50", function(value)
    local numValue = tonumber(value)
    if numValue and numValue > 0 then
        protectionSettings.detectionRange = numValue
        print("âœ… æ£€æµ‹èŒƒå›´å·²è®¾ç½®ä¸º: " .. numValue .. "ç±³")
    else
        warn("âŒ è¯·è¾“å…¥æœ‰æ•ˆçš„æ­£æ•°")
    end
end)

-- ç‚¹å‡»å»¶è¿Ÿè®¾ç½®
Input(AutoProtectTab, "ç‚¹å‡»å»¶è¿Ÿ(ç§’)", "è®¾ç½®æ£€æµ‹åˆ°åŠ¨ä½œåçš„ç‚¹å‡»å»¶è¿Ÿ", tostring(protectionSettings.clickDelay), "ä¾‹å¦‚ï¼š0.1", function(value)
    local numValue = tonumber(value)
    if numValue and numValue >= 0 then
        protectionSettings.clickDelay = numValue
        print("âœ… ç‚¹å‡»å»¶è¿Ÿå·²è®¾ç½®ä¸º: " .. numValue .. "ç§’")
    else
        warn("âŒ è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°å­—")
    end
end)

-- å†·å´æ—¶é—´è®¾ç½®ï¼ˆå›ºå®šä¸º50ç§’ï¼Œä½†ä¿ç•™è¾“å…¥æ¡†ç”¨äºæ˜¾ç¤ºï¼‰
Input(AutoProtectTab, "å†·å´æ—¶é—´(ç§’)", "å†·å´æ—¶é—´å·²å›ºå®šä¸º50ç§’", "50", "å›ºå®šå€¼: 50", function(value)
    -- å†·å´æ—¶é—´å›ºå®šä¸º50ç§’ï¼Œä¸å…è®¸ä¿®æ”¹
    protectionSettings.cooldown = 50
    print("â„¹ï¸ å†·å´æ—¶é—´å·²å›ºå®šä¸º50ç§’ï¼Œæ— æ³•ä¿®æ”¹")
end)

-- è°ƒè¯•æ¨¡å¼å¼€å…³
Toggle(AutoProtectTab, "è°ƒè¯•æ¨¡å¼", false, function(value)
    protectionSettings.debugMode = value
    if value then
        print("ğŸ”§ è°ƒè¯•æ¨¡å¼å·²å¯ç”¨")
    else
        print("ğŸ”§ è°ƒè¯•æ¨¡å¼å·²ç¦ç”¨")
    end
end)

-- æµ‹è¯•æŒ‰é’®ï¼ˆå³é”®æµ‹è¯•ï¼‰
Button(AutoProtectTab, "æµ‹è¯•å³é”®åŠŸèƒ½", function()
    virtualRightClick()
    print("ğŸ§ª å³é”®åŠŸèƒ½æµ‹è¯•å®Œæˆ")
    print("â° ä¸‹æ¬¡å¯ç‚¹å‡»æ—¶é—´: " .. os.date("%X", lastClickTime + protectionSettings.cooldown))
end)

-- é‡æ–°æ‰«ææŒ‰é’®
Button(AutoProtectTab, "é‡æ–°æ‰«æç©å®¶", function()
    print("ğŸ” é‡æ–°æ‰«æé™„è¿‘ç©å®¶...")
    if autoProtectEnabled then
        checkForProtectedAnimations()
    end
end)

-- æ˜¾ç¤ºå†·å´çŠ¶æ€
local cooldownCheckConnection = game:GetService("RunService").Heartbeat:Connect(function()
    if autoProtectEnabled then
        local currentTime = tick()
        local timeSinceLastClick = currentTime - lastClickTime
        local remainingCooldown = math.max(0, protectionSettings.cooldown - timeSinceLastClick)
        
        if remainingCooldown > 0 then
            -- æ›´æ–°çŠ¶æ€æ˜¾ç¤º
            local statusText = string.format("ğŸŸ¡ å†·å´ä¸­ (%.1fç§’)", remainingCooldown)
            -- è¿™é‡Œå¯ä»¥æ·»åŠ çŠ¶æ€æ˜¾ç¤ºæ›´æ–°é€»è¾‘
        else
            -- æ›´æ–°çŠ¶æ€æ˜¾ç¤º
            local statusText = "ğŸŸ¢ å°±ç»ª"
            -- è¿™é‡Œå¯ä»¥æ·»åŠ çŠ¶æ€æ˜¾ç¤ºæ›´æ–°é€»è¾‘
        end
    end
end)

-- çŠ¶æ€æ˜¾ç¤º
local function updateStatusDisplay()
    local currentTime = tick()
    local timeSinceLastClick = currentTime - lastClickTime
    local remainingCooldown = math.max(0, protectionSettings.cooldown - timeSinceLastClick)
    
    if remainingCooldown > 0 then
        return string.format("ğŸŸ¡ å†·å´ä¸­ (%.1fç§’)", remainingCooldown)
    else
        return "ğŸŸ¢ å°±ç»ª"
    end
end

-- å·¥å…·æŒ‰é’®
Button(AutoProtectTab, "æŠ˜å UI", function()
    Window:Close()
end)

-- ç©å®¶è¿æ¥äº‹ä»¶å¤„ç†
game.Players.PlayerAdded:Connect(function(player)
    if protectionSettings.debugMode then
        print("ğŸ‘¤ ç©å®¶åŠ å…¥: " .. player.Name)
    end
end)

game.Players.PlayerRemoving:Connect(function(player)
    if protectionSettings.debugMode then
        print("ğŸ‘¤ ç©å®¶ç¦»å¼€: " .. player.Name)
    end
end)

print("âœ… XIONè‡ªåŠ¨é˜²æŠ¤è„šæœ¬åŠ è½½å®Œæˆ (å³é”®æ¨¡å¼)")
print("â° å†·å´æ—¶é—´: 50ç§’")
